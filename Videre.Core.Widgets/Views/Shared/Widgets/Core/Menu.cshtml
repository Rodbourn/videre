@using System.Linq;
@using System.Collections.Generic;
@using Models = Videre.Core.Models;
@using Videre.Core.Extensions;

@model Models.Widget
@functions{
    private string GetUrl(string url)
    {
        return !string.IsNullOrEmpty(url) ? Url.Content(url) : "";
    }
    
}
    
@{
var searchUrl = Videre.Core.Services.Portal.CurrentPortal.GetAttribute("Core", "SearchUrl", "~/search");

Models.Menu menu = Model.GetContent<Models.Menu>();
if (menu != null)
{
    
    if (menu.ShowSearch)
    {
        Html.RegisterControlPresenter(Model, "videre.widgets.search");
    }
    
  <div id="@Model.GetId("Widget")" class="navbar @(menu.InverseColors ? "navbar-inverse" : "") @menu.Css @Model.Css" style="@Model.Style">
    <div class="navbar-inner">
      <div class="container" >
        <a class="brand" href="@Url.Content("~/")">@menu.Text</a>

        <div class="nav-collapse">
          <ul class="nav">
              @menuTemplate(menu.Items, 0)
            @helper menuTemplate(List<Models.MenuItem> items, int depth) 
            {
             foreach (var item in items.Where(i => i.IsAuthorized))
             {
                 var css = "";  //active???
                 if (item.Items.Count == 0)
                 {
                     <li><a href="@GetUrl(item.Url)">@item.Text</a></li>
                 }
                 else
                 {
                    <li class="@(depth == 0 ? "dropdown" : "dropdown-submenu")">
                        <a href="@GetUrl(item.Url)" class="dropdown-toggle" data-toggle="dropdown">@item.Text @Html.Raw(depth == 0 ? "<i class=\"caret\"></i>" : "")</a>
                        <ul class="dropdown-menu">
                            @menuTemplate(item.Items, depth + 1)
                        </ul>
                    </li>
                 }  
              }
             }
          </ul>
@{          
        if (menu.ShowSearch)
        {
          <form class="navbar-search pull-right" action="@Url.Content(searchUrl)" method="get">
            <input type="text" name="q" id="@Model.GetId("Term")" class="search-query span2" placeholder="Search" autocomplete="off">
          </form>
        }
}
        </div>
      </div>
    </div>
  </div>
}
}
