@using System.Collections.Generic;
@using Videre.Core.Extensions;
@using CoreModels = Videre.Core.Models;
@using Videre.Core.Services;
@model CoreModels.Widget
@{
    Html.RegisterWebReferenceGroup("datatables");
    Html.RegisterWebReferenceGroup("fileuploader");

    var props = new Dictionary<string, object>() { {"newManifest", new CoreModels.Package() } };
    Html.RegisterControlPresenter(Model, "videre.widgets.admin.packageexport", props);
    var providers = ImportExport.GetRegisteredProviders();
    
    

    <div id="@Model.GetId("Widget")" class="@Model.Css" style="@Model.Style">
        @{Html.RenderPartial("WidgetHeader", Model);}
        <fieldset>
            @if (Model.ShowHeader)
            {<legend class="videre section-header">@Model.GetText("WidgetTitle.Text", "Localization Administration")</legend>}

            <p>@Html.Raw(Model.GetText("Instructions.Text", "Export Package allows you to craft your own package, including the content you wish.  You can then tweak the content added by editing the JSON directly."))</p>

            <div class="container">
                <div>
                </div>
                <div class="row">
                    <div class="span2">
                        <ul class="nav nav-list videre-sidenav" id="@Model.GetId("ExportTypeList")">
                            @foreach (var provider in providers)
                            {
                                <li data-filter="@provider">
                                    <a>@provider</a>
                                </li>
                            }
                        </ul>
                    </div>
                    <div class="span10">
                        <div id="@Model.GetId("PackageCtr")" class="well">
                            <h5>@Model.GetText("Package.Text", "Package") - <span data-column="Name"></span> <span data-column="Version"></span></h5>
                            <a class="btn" data-action="edit-package"><i class="icon-edit"></i> @Model.GetPortalText("EditPackage.Text", "Edit Package")</a>
                            <a class="btn" data-action="load-package"><i class="icon-download"></i> @Model.GetPortalText("LoadPackage.Text", "Load Package")</a>
                            <a class="btn" data-action="new-package"><i class="icon-star"></i> @Model.GetPortalText("NewPackage.Text", "New Package")</a>
                            <a class="btn" data-action="download-package"><i class="icon-download-alt"></i> @Model.GetPortalText("DownloadPackage.Text", "Download Package")</a>
                        </div>
                        <div id="@Model.GetId("ItemListCtr")">
                            <table class="table table-striped table-bordered table-condensed" id="@Model.GetId("ItemTable")">
                                <thead>
                                    <tr>
                                        <th style="width: 31px"></th>
                                        <th>@Model.GetText("Name.Text", "Name")</th>
                                        <th>@Model.GetText("Preview.Text", "Preview")</th>
                                    </tr>
                                </thead>
                                <tbody id="@Model.GetId("ItemList")"></tbody>
                            </table>
                            <script id="@Model.GetId("ItemListTemplate")" type="text/html">
                                <tr>
                                    <td>
                                        {{:Included == false ? '<a class="btn btn-mini" data-id="' + Id + '" data-action="add"><i class="icon-plus"></i></a>' : ''}}
                                    </td>
                                    <td>{{:Name}}</td>
                                    <td>{{:Preview}}</td>
                                </tr>
                            </script>
                        </div>
                    </div>

                </div>
            </div>
        </fieldset>

        <div id="@Model.GetId("PackageDialog")" data-target="#@Model.GetId("PackageDialog")" class="modal fade" style="display:none;">
            <div class="modal-header">
                <a class="close" data-dismiss="modal">×</a>
                <i class="icon-gift"></i> @Model.GetText("EditPackage.Text", "Edit Package")
            </div>
            <div class="modal-body" style="width: 900px;">
                @{Html.RenderPartial("WidgetHeader", Model);}
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#@Model.GetId("ManifestTab")" data-toggle="tab"><i class="icon-list-alt"></i> @Model.GetText("Manifest.Text", "Manifest")</a></li>
                    <li class=""><a href="#@Model.GetId("ContentTab")" data-toggle="tab"><i class="icon-book"></i> @Model.GetText("Content.Text", "Content")</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="@Model.GetId("ManifestTab")">
                        <div class="form-horizontal">
                            @Html.InputControlGroup(Model, "txtName", "Name.Text", "Name", "Name")
                            @Html.InputControlGroup(Model, "txtVersion", "Version.Text", "Version", "Version", dataType: "number", inputCss: "input-mini")
                            @Html.InputControlGroup(Model, "txtType", "Type.Text", "Type", "Type")
                            @Html.InputControlGroup(Model, "txtSource", "Source.Text", "Source", "Source")
                            @Html.TextAreaControlGroup(Model, "txtDescription", "Description.Text", "Description", "Description")
                        </div>
                    </div>
                    <div class="tab-pane" id="@Model.GetId("ContentTab")">
                        <div class="form-horizontal">
                            <textarea id="@Model.GetId("txtPackageContent")" rows="15" class="span9 videre-fixed-width-font" style="font-size: 8pt;"></textarea>
                        </div>                        
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a class="btn btn-primary" id="@Model.GetId("btnPackageOk")">@Model.GetPortalText("Ok.Text", "OK")</a>
                <a class="btn" data-dismiss="modal">@Model.GetPortalText("Cancel.Text", "Cancel")</a>
            </div>
        </div>

    </div>
}
